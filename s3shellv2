#!/bin/bash

# Specify your bucket name and prefix if needed
bucket_name="your-bucket-name"
prefix=""  # e.g., "your/prefix/" if needed

# Function to list objects in S3 bucket
list_s3_objects() {
    local continuation_token=$1
    if [ -z "$continuation_token" ]; then
        aws s3api list-objects-v2 --bucket "$bucket_name" --prefix "$prefix"
    else
        aws s3api list-objects-v2 --bucket "$bucket_name" --prefix "$prefix" --continuation-token "$continuation_token"
    fi
}

# Initialize variables
filenames=()
continuation_token=""

# Collect all filenames
while : ; do
    if [ -z "$continuation_token" ]; then
        result=$(list_s3_objects)
    else
        result=$(list_s3_objects "$continuation_token")
    fi

    # Extract filenames and append to array
    filenames+=($(echo "$result" | grep -o '"Key": "[^"]*' | sed 's/"Key": "//'))

    # Check for continuation token
    continuation_token=$(echo "$result" | grep -o '"NextContinuationToken": "[^"]*' | sed 's/"NextContinuationToken": "//')
    if [ -z "$continuation_token" ]; then
        break
    fi
done

# Write filenames to CSV
echo "Filename" > filenames.csv
for filename in "${filenames[@]}"; do
    echo "$filename" >> filenames.csv
done

echo "Successfully written ${#filenames[@]} filenames to filenames.csv"
